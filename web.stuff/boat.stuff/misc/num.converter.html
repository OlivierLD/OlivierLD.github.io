<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Hex Converter</title>
        <meta charset="utf-8">
        <link rel="icon" type="image/jpg" href="hammerhead.02.ico">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
      html {
        display: table;
        width: 100%;
        height: 100%;
      }

      body {
        display: table-cell;
        /*text-align: center;*/
        color: silver;
        font-family: Verdana, Arial, Helvetica, Geneva;
        font-size: 20pt;
        vertical-align: top;
        background: radial-gradient(at top, DarkGrey -8%, black 55%);
        background-repeat: no-repeat;
        background-size: 100% 100%;
      }

      input, button {
        font-size: 20pt;
      }

      button {
          color: navy;
          border-radius: 10px;
          box-shadow: 1px 1px 2px black, 0 0 25px white, 0 0 5px silver;
      }

      h1 {
        color: silver;
        font-style: italic;
        font-size: 36pt;
        font-family: Verdana, Arial, Helvetica, Geneva;
        padding-left: 5pt;
        padding-bottom: 1pt;
        padding-top: 1pt;
      }

      .display-result {
        font-size: 36pt;
        text-shadow: 1px 1px 2px black, 0 0 25px white, 0 0 5px silver;
        font-family:'Courier New', Courier, monospace; 
        font-weight: bold; 
        text-align: right;
      }

      .small-label {
          font-size: 10px;
          text-align: left;
          vertical-align: bottom;
          padding-top: 20px;
      }

      /* 
          See https://codepen.io/shimdim/pen/NjyNNb 
              https://blog.logrocket.com/creating-beautiful-tooltips-with-only-css/
      */
      /*You can use [title] selector as well*/
      [data-title] {
        /*outline: red dotted 1px;*/ /*optional styling*/
        /*font-size: 30px;*/ /*optional styling*/
        position: relative;
        cursor: help;
      }

      [data-title]:hover::before {
        content: attr(data-title); /* Content of attribute data-title */
        position: absolute;
        bottom: -26px;
        display: inline-block;
        padding: 3px 6px;
        border-radius: 2px;
        background: #000;
        color: #fff;
        font-size: 12px;
        font-family: sans-serif;
        white-space: nowrap;
        z-index: 10;
      }

      [data-title]:hover::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 8px;
        display: inline-block;
        color: #fff;
        border: 2px solid red;	
        border: 8px solid transparent;	
        border-bottom: 8px solid #000;
      }

      .smooth {
            /*height: 0;*/
            /*visibility: hidden;*/
            /*opacity: 0;*/
            /*transition: visibility 0.5s, height 0.5s, opacity 0.5s linear;*/
            height: 0;
            max-height: 0;
            margin: auto;
            /*transition: transform 0.5s, max-height 1s, height 1s;*/
            transition: all 0.5s ease;
            opacity: 0;
            transform: scaleY(0);
            transform-origin: top;
            overflow: hidden;
        }

        .visible-div {
            opacity: 1;
            width: auto;
            height: auto;
            max-height: 1600px;
            transform: scaleY(1);
            margin-top: 5px;
        }

        </style>
        <script type="module" src="./SplitFlapDisplay.js"></script>
    </head>        
    <body>
        <h1>Decimal to Sexagesimal, and vice-versa</h1>
        <div>
            <small style="padding-left: 10px;">Enter values to convert in the fields, and hit the "Convert" button in the corresponding line.</small>
        </div>
        <hr/>
        <div id="alert-zone" class="smooth" style="padding: 2px; border: 1px solid red; border-radius: 5px; padding: 5px;"> <!-- display: none;  -->
            <div id="alert-mess" style="color: green; background-color: orange; border-radius: 5px; padding: 5px;"></div>
        </div>    
        <div style="padding-left: 5px;">
            <table>
                <tr>
                    <td style="text-align: right;">Decimal degrees</td>
                    <td colspan="3"><input type="number" 
                                           id="decimal" 
                                           title="Decimal Degrees to convert"
                                           style="width: 150px; text-align: right;"
                                           min="0"
                                           max="180"
                                           step="0.01"   
                                           pattern="^\d+(?:\.\d{1,6})?$"                                      
                                           placeholder="Dec. Degrees">&deg;</td>
                    <td><button id="from-decimal" onclick="fromDecimal();" title="Convert decimal degrees&#13;to all formats">Convert</button></td>
                </tr>
                <tr>
                    <td style="text-align: right;">Degrees, decimal minutes</td>
                    <td><input type="number" 
                               id="deg-one" 
                               title="Degrees to convert (int)"
                               style="width: 150px; text-align: right;"
                               min="0"
                               max="180"
                               step="1"    
                               pattern="^\d$"                                     
                               placeholder="Degrees">&deg;</td>
                    <td colspan="2"><input type="number" 
                                           id="minutes" 
                                           title="Decimal Minutes to convert"
                                           style="width: 150px; text-align: right;"
                                           min="0"
                                           max="60"
                                           step="0.01"                                         
                                           placeholder="Dec. Minutes">'</td>
                    <td><button id="from-dec-min" onclick="fromDegMin();" title="Convert degrees and&#13;decimal minutes&#13;to all formats">Convert</button></td>
                </tr>
                <tr>
                    <td style="text-align: right;">Degrees, minutes, decimal seconds</td>
                    <td><input type="number" 
                               id="deg-two" 
                               title="Degrees to convert (int)"
                               style="width: 150px; text-align: right;"
                               min="0"
                               max="180"
                               step="1"                                         
                               placeholder="Degrees">&deg;</td>
                    <td><input type="number" 
                               id="min-two" 
                               title="Minutes to convert (int)"
                               style="width: 150px; text-align: right;"
                               min="0"
                               max="59"
                               step="1"                                         
                               placeholder="Minutes">'</td>
                    <td><input type="number" 
                               id="seconds" 
                               title="Decimal Seconds to convert"
                               style="width: 150px; text-align: right;"
                               min="0"
                               max="60"
                               step="0.01"                                         
                               placeholder="Dec. Seconds">"</td>
                    <td><button id="from-dec-min-sec" onclick="fromDegMinSec();" title="Convert degrees,&#13;minutes and decimal seconds&#13;to all formats">Convert</button></td>
                </tr>
            </table>
        </div>
        <hr/>
        <div id="results" style="display: none; padding-left: 10px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr auto;">
                <div class="display-result" style="display: grid; grid-template-columns: auto auto;">
                    <div class="small-label">Decimal deg</div><div id="01" class="display-result" title="Decimal Degrees"></div>
                    <div class="small-label">Degrees decimal minutes</div><div id="02" class="display-result" title="Degrees&#13;Decimal Minutes"></div>
                    <div class="small-label">Degrees minutes decimal seconds</div><div id="03" class="display-result" title="Degrees&#13;Minutes&#13;Decimal Seconds"></div>
                </div>
                <div style="margin-top: 10px; margin-left: 16px">
                    <split-flap-display id="decimal-deg-display"
                                        nb-char="15"
                                        justified="RIGHT"
                                        font-size="40"
                                        title="Decimal Degrees"
                                        value="000.000000°"></split-flap-display>
                    <split-flap-display id="deg-decimal-min-display"
                                        nb-char="15"
                                        justified="RIGHT"
                                        font-size="40"
                                        title="Degrees&#13;Decimal Minutes"
                                        value="000°00.0000'"></split-flap-display>
                    <split-flap-display id="deg-min-decimal-sec-display"
                                        nb-char="15"
                                        justified="RIGHT"
                                        font-size="40"
                                        title="Degrees&#13;Minutes&#13;Decimal Seconds"
                                        value="000°00'00.0000 "></split-flap-display>
                </div>
                <div>
                    <button onclick="copyToClipboard('01')"><img src="icons8-copy-to-clipboard-50.png" style="width: 40px; height: auto;" title="Copy to Clipboard"></button>
                    <br/>
                    <button onclick="copyToClipboard('02')"><img src="icons8-copy-to-clipboard-50.png" style="width: 40px; height: auto;" title="Copy to Clipboard"></button>
                    <br/>
                    <button onclick="copyToClipboard('03')"><img src="icons8-copy-to-clipboard-50.png" style="width: 40px; height: auto;" title="Copy to Clipboard"></button>
                </div>
            </div>
        </div>
        <hr/>
        <i style="padding-left: 20px; text-shadow: 1px 1px 2px orange, 0 0 25px white, 0 0 5px silver;">Wow!</i>
    </body>
    <script type="text/javascript">
displayResult = (one, two, three) => {
    document.getElementById("results").style.display = "grid";
    document.getElementById("01").innerHTML = one;
    document.getElementById("02").innerHTML = two;
    document.getElementById("03").innerHTML = three;
};

fromDecimal = () => {
    let original = document.getElementById("decimal");
    let originalValue = parseFloat(original.value);
    if (isNaN(originalValue)) {
        originalValue = 0;
    }
    if (originalValue < 0) {
        alert("Positive values only, thanks.")
        originalValue *= -1;
    }
    console.log(`Converting ${originalValue}`);
    // Int part (degrees)
    let degrees = Math.floor(originalValue);
    let decimalPart = originalValue - degrees;
    let decimalMin = decimalPart * 60;
    // Minutes
    let intMin = Math.floor(decimalMin);
    // Seconds
    let decimalSeconds = (decimalMin - intMin) * 60;
    // Display on other fields.
    document.getElementById("deg-one").value = degrees;
    document.getElementById("minutes").value = decimalMin.toFixed(4);

    document.getElementById("deg-two").value = degrees;
    document.getElementById("min-two").value = intMin;
    document.getElementById("seconds").value = decimalSeconds.toFixed(4);

    displayResult(
        `${originalValue.toFixed(6)}&deg;`,
        `${degrees}&deg;${decimalMin.toFixed(4)}'`,
        `${degrees}&deg;${intMin}'${decimalSeconds.toFixed(4)}"`
    );

    setSplitFlapValue("decimal-deg-display", `${originalValue.toFixed(6)}°`);
    setSplitFlapValue("deg-decimal-min-display", `${degrees}°${decimalMin.toFixed(4)}'`);
    setSplitFlapValue("deg-min-decimal-sec-display", `${degrees}°${intMin}'${decimalSeconds.toFixed(4)}"`);
};

fromDegMin = () => {
    let degOriginal = parseInt(document.getElementById("deg-one").value);
    let minOriginal = parseFloat(document.getElementById("minutes").value);
    if (isNaN(degOriginal)) {
        degOriginal = 0;
    }
    if (isNaN(minOriginal)) {
        minOriginal = 0;
    }
    if (degOriginal < 0) {
        alert("Positive values only, thanks.")
        degOriginal *= -1;
    }
    if (! (minOriginal >= 0 && minOriginal < 60.0)) {
        alert("Minutes shoud be positive and lower than 60. Setting it to 0.");
        minOriginal = 0;
    }
    console.log(`Converting ${degOriginal}, ${minOriginal}`);
    let decimalDeg = degOriginal + (minOriginal / 60);
    let intMinutes = Math.floor(minOriginal);
    let decimalSec = (minOriginal - intMinutes) * 60;

    document.getElementById("decimal").value = decimalDeg.toFixed(6);
    document.getElementById("deg-two").value = degOriginal;
    document.getElementById("min-two").value = intMinutes;
    document.getElementById("seconds").value = decimalSec.toFixed(4);

    displayResult(
        `${decimalDeg.toFixed(6)}&deg;`,
        `${degOriginal}&deg;${minOriginal.toFixed(4)}'`,
        `${degOriginal}&deg;${intMinutes}'${decimalSec.toFixed(4)}"`
    );
    setSplitFlapValue("decimal-deg-display", `${decimalDeg.toFixed(6)}°`);
    setSplitFlapValue("deg-decimal-min-display", `${degOriginal}°${minOriginal.toFixed(4)}'`);
    setSplitFlapValue("deg-min-decimal-sec-display", `${degOriginal}°${intMinutes}'${decimalSec.toFixed(4)}"`);
};

fromDegMinSec = () => {
    let degOriginal = parseInt(document.getElementById("deg-two").value);
    let minOriginal = parseInt(document.getElementById("min-two").value);
    let secOriginal = parseFloat(document.getElementById("seconds").value);
    if (isNaN(degOriginal)) {
        degOriginal = 0;
    }
    if (isNaN(minOriginal)) {
        minOriginal = 0;
    }
    if (isNaN(secOriginal)) {
        secOriginal = 0;
    }
    if (degOriginal < 0) {
        alert("Positive values only, thanks.")
        degOriginal *= -1;
    }
    if (! (minOriginal >= 0 && minOriginal < 60.0)) {
        alert("Minutes shoud be positive and lower than 60. Setting it to 0.");
        minOriginal = 0;
    }
    if (! (secOriginal >= 0 && secOriginal < 60.0)) {
        alert("Seconds shoud be positive and lower than 60. Setting it to 0.");
        secOriginal = 0;
    }
    console.log(`Converting ${degOriginal}, ${minOriginal}, ${secOriginal}`);
    let decimalDeg = degOriginal + (minOriginal / 60) + (secOriginal / 3600);
    let decimalMin = minOriginal + (secOriginal / 60);

    document.getElementById("decimal").value = decimalDeg.toFixed(6);
    document.getElementById("deg-one").value = degOriginal;
    document.getElementById("minutes").value = decimalMin.toFixed(4);

    displayResult(
        `${decimalDeg.toFixed(6)}&deg;`,
        `${degOriginal}&deg;${decimalMin.toFixed(4)}'`,
        `${degOriginal}&deg;${minOriginal}'${secOriginal.toFixed(4)}"`
    );
    setSplitFlapValue("decimal-deg-display", `${decimalDeg.toFixed(6)}°`);
    setSplitFlapValue("deg-decimal-min-display", `${degOriginal}°${decimalMin.toFixed(4)}'`);
    setSplitFlapValue("deg-min-decimal-sec-display", `${degOriginal}°${minOriginal}'${secOriginal.toFixed(4)}"`);
};

setSplitFlapValue = (id, value) => {
    let elem = document.getElementById(id);
    // Character by character, flap-flap-flap
    let original = elem.paddedValue;
    let newPaddedValue = elem.getPaddedValue(elem.cleanString(value));
    // console.log("Old [%s], new [%s]", original, newPaddedValue);
    // assert(old.length === new.length);

    function updateFlap(idx) { // THIS is balaise. Recursive inner function.
        if (original.charAt(idx).toUpperCase() !== newPaddedValue.charAt(idx).toUpperCase()) {
            setTimeout(() => {
                let next = elem.getNextChar(original.charAt(idx));
//                console.log("Updating %s with %s", original, next);
                elem.setCharAt(idx, next);
                original = elem.paddedValue;
                updateFlap(idx);
            }, 50);
        }
    }

    for (let idx = 0; idx < original.length; idx++) {
        updateFlap(idx);
    }
//     elem.value = value;
//     elem.repaint();
};

let customAlertExpanded = false;
let expandCollapseAlertData = () => {
    document.getElementById('alert-zone').classList.toggle('visible-div');
    customAlertExpanded = !customAlertExpanded;
};

let customAlert = (errMess) => {
    document.getElementById('alert-mess').innerText = errMess;
    if (!customAlertExpanded) {
        expandCollapseAlertData();
    }
    setTimeout(hideAlert, 5000);
};

let hideAlert = () => {
    if (customAlertExpanded) {
        expandCollapseAlertData();
    }
};

let copyToClipboard = (fieldId) => {
    let value = document.getElementById(fieldId).innerHTML;
    let codeContent = value.replaceAll("<br>", "\n");
    // console.log(codeContent);
    let codeHolder = document.createElement("textarea"); // To keep the format, 'input' would not.
    codeHolder.value = codeContent;
    document.body.appendChild(codeHolder);
    codeHolder.select();
    document.execCommand("copy");
    document.body.removeChild(codeHolder);
    alert(`Value ${value} copied to clipboard`);
};

window.alert = customAlert; // Override!

</script>
</html>