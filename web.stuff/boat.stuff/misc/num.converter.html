<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Hex Converter</title>
        <meta charset="utf-8">
        <link rel="icon" type="image/jpg" href="hammerhead.02.ico">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
      html {
        display: table;
        width: 100%;
        height: 100%;
      }

      body {
        display: table-cell;
        /*text-align: center;*/
        color: silver;
        font-family: Verdana, Arial, Helvetica, Geneva;
        font-size: 20pt;
        vertical-align: top;
        background: radial-gradient(at top, DarkGrey -8%, black 55%);
        background-repeat: no-repeat;
        background-size: 100% 100%;
      }

      input, button {
        font-size: 20pt;
      }

      button {
          color: navy;
          border-radius: 10px;
          box-shadow: 1px 1px 2px black, 0 0 25px white, 0 0 5px silver;
      }

      h1 {
        color: silver;
        font-style: italic;
        font-size: 36pt;
        font-family: Verdana, Arial, Helvetica, Geneva;
        padding-left: 5pt;
        padding-bottom: 1pt;
        padding-top: 1pt;
      }

      .display-result {
        font-size: 36pt;
        text-shadow: 1px 1px 2px black, 0 0 25px white, 0 0 5px silver;
        font-family:'Courier New', Courier, monospace; 
        font-weight: bold; 
        text-align: right;
      }
        </style>
        <script type="module" src="./SplitFlapDisplay.js"></script>
    </head>        
    <body>
        <h1>Hexdecimal to Sexagesimal, and vice-versa</h1>
        <div>
            <small style="padding-left: 10px;">Enter values to convert, and hit the "Convert" in the corresponding line.</small>
        </div>
        <hr/>
        <div style="padding-left: 5px;">
            <table>
                <tr>
                    <td style="text-align: right;">Decimal degrees</td>
                    <td colspan="3"><input type="number" 
                                           id="decimal" 
                                           title="Decimal Degrees to convert"
                                           style="width: 150px; text-align: right;"
                                           min="0"
                                           max="180"
                                           step="0.01"   
                                           pattern="^\d+(?:\.\d{1,6})?$"                                      
                                           placeholder="Dec. Degrees">&deg;</td>
                    <td><button id="from-decimal" onclick="fromDecimal();" title="Convert to all formats">Convert</button></td>
                </tr>
                <tr>
                    <td style="text-align: right;">Degrees, decimal minutes</td>
                    <td><input type="number" 
                               id="deg-one" 
                               title="Degrees to convert (int)"
                               style="width: 150px; text-align: right;"
                               min="0"
                               max="180"
                               step="1"    
                               pattern="^\d$"                                     
                               placeholder="Degrees">&deg;</td>
                    <td colspan="2"><input type="number" 
                                           id="minutes" 
                                           title="Decimal Minutes to convert"
                                           style="width: 150px; text-align: right;"
                                           min="0"
                                           max="60"
                                           step="0.01"                                         
                                           placeholder="Dec. Minutes">'</td>
                    <td><button id="from-dec-min" onclick="fromDegMin();" title="Convert to all formats">Convert</button></td>
                </tr>
                <tr>
                    <td style="text-align: right;">Degrees, minutes, decimal seconds</td>
                    <td><input type="number" 
                               id="deg-two" 
                               title="Degrees to convert (int)"
                               style="width: 150px; text-align: right;"
                               min="0"
                               max="180"
                               step="1"                                         
                               placeholder="Degrees">&deg;</td>
                    <td><input type="number" 
                               id="min-two" 
                               title="Minutes to convert (int)"
                               style="width: 150px; text-align: right;"
                               min="0"
                               max="59"
                               step="1"                                         
                               placeholder="Minutes">'</td>
                    <td><input type="number" 
                               id="seconds" 
                               title="Decimal Seconds to convert"
                               style="width: 150px; text-align: right;"
                               min="0"
                               max="60"
                               step="0.01"                                         
                               placeholder="Dec. Seconds">"</td>
                    <td><button id="from-dec-min-sec" onclick="fromDegMinSec();" title="Convert to all formats">Convert</button></td>
                </tr>
            </table>
        </div>
        <hr/>
        <div id="results" style="display: none; padding-left: 10px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr;">
                <div class="display-result">
                    <div id="01" class="display-result"></div>
                    <div id="02" class="display-result"></div>
                    <div id="03" class="display-result"></div>
                </div>
                <div style="margin-top: 10px; margin-left: 16px">
                    <split-flap-display id="decimal-deg-display"
                                        nb-char="15"
                                        justified="RIGHT"
                                        font-size="40"
                                        value="000.000000°"></split-flap-display>
                    <split-flap-display id="deg-decimal-min-display"
                                        nb-char="15"
                                        justified="RIGHT"
                                        font-size="40"
                                        value="000°00.0000'"></split-flap-display>
                    <split-flap-display id="deg-min-decimal-sec-display"
                                        nb-char="15"
                                        justified="RIGHT"
                                        font-size="40"
                                        value="000°00'00.0000 "></split-flap-display>
                </div>
            </div>
        </div>
        <hr/>
        <i>Wow!</i>
    </body>
    <script type="text/javascript">
displayResult = (one, two, three) => {
    document.getElementById("results").style.display = "grid";
    document.getElementById("01").innerHTML = one;
    document.getElementById("02").innerHTML = two;
    document.getElementById("03").innerHTML = three;
};

fromDecimal = () => {
    let original = document.getElementById("decimal");
    let originalValue = parseFloat(original.value);
    console.log(`Converting ${originalValue}`);
    // Int part (degrees)
    let degrees = Math.floor(originalValue);
    let decimalPart = originalValue - degrees;
    let decimalMin = decimalPart * 60;
    // Minutes
    let intMin = Math.floor(decimalMin);
    // Seconds
    let decimalSeconds = (decimalMin - intMin) * 60;
    // Display on other fields.
    document.getElementById("deg-one").value = degrees;
    document.getElementById("minutes").value = decimalMin.toFixed(4);

    document.getElementById("deg-two").value = degrees;
    document.getElementById("min-two").value = intMin;
    document.getElementById("seconds").value = decimalSeconds.toFixed(4);

    displayResult(
        `${originalValue.toFixed(6)}&deg;`,
        `${degrees}&deg;${decimalMin.toFixed(4)}'`,
        `${degrees}&deg;${intMin}'${decimalSeconds.toFixed(4)}"`
    );

    setSplitFlapValue("decimal-deg-display", `${originalValue.toFixed(6)}°`);
    setSplitFlapValue("deg-decimal-min-display", `${degrees}°${decimalMin.toFixed(4)}'`);
    setSplitFlapValue("deg-min-decimal-sec-display", `${degrees}°${intMin}'${decimalSeconds.toFixed(4)}"`);
};

fromDegMin = () => {
    let degOriginal = parseInt(document.getElementById("deg-one").value);
    let minOriginal = parseFloat(document.getElementById("minutes").value);
    console.log(`Converting ${degOriginal}, ${minOriginal}`);
    let decimalDeg = degOriginal + (minOriginal / 60);
    let intMinutes = Math.floor(minOriginal);
    let decimalSec = (minOriginal - intMinutes) * 60;

    document.getElementById("decimal").value = decimalDeg.toFixed(6);
    document.getElementById("deg-two").value = degOriginal;
    document.getElementById("min-two").value = intMinutes;
    document.getElementById("seconds").value = decimalSec.toFixed(4);

    displayResult(
        `${decimalDeg.toFixed(6)}&deg;`,
        `${degOriginal}&deg;${minOriginal.toFixed(4)}'`,
        `${degOriginal}&deg;${intMinutes}'${decimalSec.toFixed(4)}"`
    );
    setSplitFlapValue("decimal-deg-display", `${decimalDeg.toFixed(6)}°`);
    setSplitFlapValue("deg-decimal-min-display", `${degOriginal}°${minOriginal.toFixed(4)}'`);
    setSplitFlapValue("deg-min-decimal-sec-display", `${degOriginal}°${intMinutes}'${decimalSec.toFixed(4)}"`);
};

fromDegMinSec = () => {
    let degOriginal = parseInt(document.getElementById("deg-two").value);
    let minOriginal = parseInt(document.getElementById("min-two").value);
    let secOriginal = parseFloat(document.getElementById("seconds").value);
    console.log(`Converting ${degOriginal}, ${minOriginal}, ${secOriginal}`);
    let decimalDeg = degOriginal + (minOriginal / 60) + (secOriginal / 3600);
    let decimalMin = minOriginal + (secOriginal / 60);

    document.getElementById("decimal").value = decimalDeg.toFixed(6);
    document.getElementById("deg-one").value = degOriginal;
    document.getElementById("minutes").value = decimalMin.toFixed(4);

    displayResult(
        `${decimalDeg.toFixed(6)}&deg;`,
        `${degOriginal}&deg;${decimalMin.toFixed(4)}'`,
        `${degOriginal}&deg;${minOriginal}'${secOriginal.toFixed(4)}"`
    );
    setSplitFlapValue("decimal-deg-display", `${decimalDeg.toFixed(6)}°`);
    setSplitFlapValue("deg-decimal-min-display", `${degOriginal}°${decimalMin.toFixed(4)}'`);
    setSplitFlapValue("deg-min-decimal-sec-display", `${degOriginal}°${minOriginal}'${secOriginal.toFixed(4)}"`);
};

setSplitFlapValue = (id, value) => {
            let elem = document.getElementById(id);
            // Character by character, flap-flap-flap
            let original = elem.paddedValue;
            let newPaddedValue = elem.getPaddedValue(elem.cleanString(value));
            //        console.log("Old [%s], new [%s]", original, newPaddedValue);
            //        assert(old.length === new.length);

            function updateFlap(idx) { // THIS is balaise.
                if (original.charAt(idx).toUpperCase() !== newPaddedValue.charAt(idx).toUpperCase()) {
                    setTimeout(() => {
                        let next = elem.getNextChar(original.charAt(idx));
//                                        console.log("Updating %s with %s", original, next);
                        elem.setCharAt(idx, next);
                        original = elem.paddedValue;
                        updateFlap(idx);
                    }, 50);
                }
            }

            for (let idx = 0; idx < original.length; idx++) {
                updateFlap(idx);
            }
//                elem.value = value;
//                elem.repaint();
        };

    </script>
</html>